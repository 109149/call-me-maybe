(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{128:function(e,t,n){"use strict";n.r(t);var r,o,a,c,s,i=n(4),u=n(0),d=n.n(u),l=n(65),j=n.n(l),b=(n(75),n(10)),f=n(31),p=n(11),m=n(1),h=Object(p.b)(r||(r=Object(b.a)(["\n  100% {\n    opacity: 1;\n  }\n  10% {\n    opacity: 0;\n  }\n"]))),x=p.a.div(o||(o=Object(b.a)(["\n  position: absolute;\n  opacity: 0;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  border: 1px solid #000;\n  padding: 12px;\n  border-radius: 5px;\n  max-width: 200px;\n  font-size: 0.9rem;\n  color: #fff;\n  z-index: 10000;\n  text-align: center;\n  background: hsl(0, 0%, 28%);\n  animation: "," 2s;\n"])),h),O=function(e){var t=e.show,n=void 0!==t&&t,r=e.text,o=Object(f.a)(e,["show","text"]);return Object(m.jsx)(m.Fragment,{children:n&&Object(m.jsx)(x,Object(i.a)(Object(i.a)({},o),{},{children:r}))})},v=n(5),g=n.n(v),w=n(19),k=n(12),R=n(69),I=n(2),_=n(6),y=n.n(_),C=n(22),N=n.n(C),S={iceServers:[{urls:["stun:stun1.1.google.com:19302","stun:stun2.1.google.com:19302"]}],iceCandidatePoolSize:10},P={audio:!0,video:{width:{exact:320},height:{exact:240}},aspectRatio:{exact:320/240}},E=function(e){var t=d.a.useState({show:!1,text:""}),n=Object(k.a)(t,2),r=n[0],o=n[1],a=Object(I.g)().id,c=d.a.useState({redirect:!1,path:"/",roomId:a}),s=Object(k.a)(c,2),u=s[0],l=s[1],j=d.a.useState(null),b=Object(k.a)(j,2),f=b[0],p=b[1],h=d.a.useState(null),x=Object(k.a)(h,2),v=x[0],_=x[1],C=d.a.useRef(),E=d.a.useRef(),V=d.a.useRef(),D=d.a.useRef();d.a.useEffect((function(){1===Number(window.sessionStorage.getItem("NoRedirect"))||e&&e.location&&e.location.state&&e.location.state.redirected||l((function(e){return Object(i.a)(Object(i.a)({},e),{},{redirect:!0})}))}),[]),d.a.useEffect((function(){v&&(D.current=new RTCPeerConnection(S),D.current.onicecandidate=function(e){var t=e.candidate;v.emit("signal-candidate",{roomId:a,candidate:t})},D.current.onnegotiationneeded=Object(w.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=D.current,e.next=4,D.current.createOffer();case 4:return e.t1=e.sent,e.next=7,e.t0.setLocalDescription.call(e.t0,e.t1);case 7:v.emit("offer",{roomId:a,desc:D.current.localDescription}),e.next=14;break;case 10:e.prev=10,e.t2=e.catch(0),console.error(e.t2),o({show:!0,text:e.t2.message});case 14:case"end":return e.stop()}}),e,null,[[0,10]])}))),D.current.ontrack=function(e){V.current.srcObject||(V.current.srcObject=e.streams[0])},D.current.onicegatheringstatechange=function(e){})}),[v]),d.a.useEffect((function(){if(v)return v.on("log",(function(){})),v.on("message",function(){var e=Object(w.a)(g.a.mark((function e(t){var n,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.desc,r=t.candidate,e.prev=1,!n){e.next=22;break}if("offer"!==n.type){e.next=15;break}return e.next=6,D.current.setRemoteDescription(n);case 6:return e.t0=D.current,e.next=9,D.current.createAnswer();case 9:return e.t1=e.sent,e.next=12,e.t0.setLocalDescription.call(e.t0,e.t1);case 12:v.emit("answer",{roomId:a,desc:D.current.localDescription}),e.next=20;break;case 15:if("answer"!==n.type){e.next=20;break}return e.next=18,D.current.setRemoteDescription(n);case 18:e.next=20;break;case 20:e.next=25;break;case 22:if(!r){e.next=25;break}return e.next=25,D.current.addIceCandidate(r);case 25:e.next=31;break;case 27:e.prev=27,e.t2=e.catch(1),console.error(e.t2),o({show:!0,text:e.t2.message});case 31:case"end":return e.stop()}}),e,null,[[1,27]])})));return function(t){return e.apply(this,arguments)}}()),v.on("created-room",(function(e){e.roomId})),v.on("user-disconnected",(function(e){e.userId;V.current.srcObject=null})),v.on("joined",(function(e){var t=e.userId;p(t)})),function(){v.close()}}),[v]);var W=function(){var e=Object(w.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E.current){e.next=15;break}return e.prev=1,_((function(){var e=R.io.connect();return e.emit("join-room",{roomId:a}),e})),e.next=5,navigator.mediaDevices.getUserMedia(P);case 5:t=e.sent,E.current=t,C.current.srcObject=E.current,E.current.getTracks().forEach((function(e){return D.current.addTrack(e,t)})),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),console.error(e.t0),o({show:!0,text:e.t0.message});case 15:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=Object(w.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("/api/rooms/leave",{roomId:a,userId:f});case 2:e.sent.data.success?(C.current&&(C.current.srcObject&&C.current.srcObject.getTracks().forEach((function(e){e.stop()})),E.current=null,C.current.srcObject=E.current),V.current&&(V.current.srcObject&&V.current.srcObject.getTracks().forEach((function(e){e.stop()})),V.current.srcObject=null),v&&v.close(),l({redirect:!0,path:"/",roomId:""})):console.error("couldn't leave the room.");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(m.jsx)(m.Fragment,{children:u.redirect?Object(m.jsx)(I.a,{to:{pathname:u.path||"/",state:{roomId:u.roomId}}}):Object(m.jsxs)("div",{className:y.a.room,children:[Object(m.jsx)(O,{show:r.show,text:r.text}),Object(m.jsxs)("div",{className:y.a.videos,children:[Object(m.jsx)("div",{className:"".concat(y.a.videoWrapper," ").concat(y.a.mainVideo),children:Object(m.jsx)("video",{ref:C,autoPlay:!0,playsInline:!0})}),Object(m.jsx)("div",{className:"".concat(y.a.videoWrapper," ").concat(y.a.floatingVideo),children:Object(m.jsx)("video",{ref:V,autoPlay:!0,playsInline:!0})}),Object(m.jsxs)("div",{className:"".concat(y.a.controls),children:[Object(m.jsx)(F,{onClick:W,children:"start"}),Object(m.jsx)(F,{onClick:function(){var e=document.querySelector(".".concat(y.a.floatingVideo)),t=document.querySelector(".".concat(y.a.mainVideo));e.classList.replace(y.a.floatingVideo,y.a.mainVideo),t.classList.replace(y.a.mainVideo,y.a.floatingVideo)},children:"swap"}),Object(m.jsx)(F,{onClick:z,children:"hang up"})]})]})]})})},V=p.a.input(a||(a=Object(b.a)(["\n  border: 2px solid black;\n  border-radius: 6px;\n  font-size: 1.125rem;\n  padding: 5px;\n"]))),D=function(e){return Object(m.jsx)(V,Object(i.a)({},e))},W=n(70),z=n.n(W),M=p.a.button(c||(c=Object(b.a)(["\n  background-color: ",";\n  font-size: 1.125rem;\n  padding: 6px;\n  border-radius: 6px;\n  letter-spacing: 1px;\n  border: 2px solid black;\n  text-transform: uppercase;\n  font-weight: bold;\n\n  &:hover {\n    background-color: ",";\n  }\n"])),(function(e){var t=e.bkgColor;return t.default?t.default:"hsl(29, 100%, 71%)"}),(function(e){var t=e.bkgColor;return t.hover?t.hover:"hsl(29, 100%, 61%)"})),F=function(e){var t=e.bkgColor,n=void 0===t?{default:"hsl(29, 100%, 71%)",hover:"hsl(29, 100%, 61%)"}:t,r=e.children,o=Object(f.a)(e,["bkgColor","children"]);return Object(m.jsx)(M,Object(i.a)(Object(i.a)({className:z.a.hoverable,bkgColor:n},o),{},{children:r}))},T=function(){var e=Object(w.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("/api/rooms/create",Object(i.a)({},t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=Object(w.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("/api/rooms/join",Object(i.a)({},t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var L,H,q=p.a.div(s||(s=Object(b.a)(["\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n"]))),B=function(e){var t=d.a.useState({show:!1,text:""}),n=Object(k.a)(t,2),r=n[0],o=n[1],a=d.a.useState("PEER_NAME"),c=Object(k.a)(a,2),s=c[0],i=c[1],u=d.a.useState("ROOM_NAME"),l=Object(k.a)(u,2),j=l[0],b=l[1],f=d.a.useState(""),p=Object(k.a)(f,2),h=p[0],x=p[1],v=d.a.useState(!0),g=Object(k.a)(v,2),w=g[0],R=g[1],_=d.a.useState({}),y=Object(k.a)(_,2),C=y[0],N=y[1];return d.a.useEffect((function(){var t=window.location.search.split("=")[1];window.sessionStorage.setItem("NoRedirect",0),t?(window.location.search="",x(t)):e&&e.location&&e.location.state&&e.location.state.roomId&&(t=e.location.state.roomId,x(t))}),[]),Object(m.jsx)(m.Fragment,{children:C.roomPath?Object(m.jsx)(I.a,{to:{pathname:C.roomPath,state:{redirected:!0}}}):Object(m.jsxs)(q,{children:[Object(m.jsx)(O,{show:r.show,text:r.text}),Object(m.jsx)(Q,{handleRoomDescriptionCHange:function(){R((function(e){return!e}))},handlePeerNameChange:function(e){i(e.target.value)},handleRoomNameChange:function(e){b(e.target.value)},handleRoomIdChange:function(e){x(e.target.value)},peerName:s,roomName:j,roomId:h,roomIsPublic:w,createRoom:function(){T({peerName:s,roomName:j,roomIsPublic:w}).then((function(e){window.sessionStorage.setItem("NoRedirect",1),N(e)})).catch((function(e){console.error(e),o({show:!0,text:e.response.data.error})}))},joinRoom:function(){A({peerName:s,roomId:h}).then((function(e){window.sessionStorage.setItem("NoRedirect",1),N(e)})).catch((function(e){console.error(e),o({show:!0,text:e.response.data.error})}))}})]})})},J=p.a.div(L||(L=Object(b.a)(["\n  display: flex;\n  align-items: center;\n  flex-direction: column;\n  justify-content: center;\n\n  & div {\n    margin: 12px;\n  }\n"]))),G=p.a.div(H||(H=Object(b.a)(["\n  color: white;\n  text-transform: uppercase;\n  font-weight: bold;\n"]))),Q=function(e){e.handleRoomDescriptionCHange,e.handlePeerNameChange,e.handleRoomNameChange;var t=e.handleRoomIdChange,n=(e.peerName,e.roomName,e.roomIsPublic,e.roomId),r=e.createRoom,o=e.joinRoom;return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("div",{}),Object(m.jsxs)(J,{children:[Object(m.jsx)("div",{children:Object(m.jsx)(F,{onClick:r,children:"create"})}),Object(m.jsx)(G,{children:"or"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(F,{onClick:o,bkgColor:{default:"hsl(14, 100%, 66%)",hover:"hsl(14, 100%, 56%)"},children:"join"}),Object(m.jsx)(D,{type:"text",onChange:t,value:n,placeholder:"Room ID"})]})]})]})},U=n(25);function X(){return Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(U.a,{children:Object(m.jsxs)(I.d,{children:[Object(m.jsx)(I.b,{exact:!0,path:"/",render:function(e){return Object(m.jsx)(B,Object(i.a)({},e))}}),Object(m.jsx)(I.b,{path:"/rooms/:id",render:function(e){return Object(m.jsx)(E,Object(i.a)({},e))}})]})})})}j.a.render(Object(m.jsx)(d.a.StrictMode,{children:Object(m.jsx)(X,{})}),document.getElementById("root"))},6:function(e,t,n){e.exports={room:"Room_room__1Qxur",videos:"Room_videos__1mony",videoWrapper:"Room_videoWrapper__32MCG",controls:"Room_controls__3BHzR",mainVideo:"Room_mainVideo__1yyR-",floatingVideo:"Room_floatingVideo__2_0S_",canvasWrapper:"Room_canvasWrapper__2WO9P"}},70:function(e,t,n){e.exports={hoverable:"global_hoverable__WZ7oA"}},75:function(e,t,n){}},[[128,1,2]]]);
//# sourceMappingURL=main.a52d988b.chunk.js.map